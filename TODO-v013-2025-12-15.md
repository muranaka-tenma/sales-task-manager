# Kanban Work - TODO一覧

**バージョン**: v013
**作成日**: 2025-12-15
**最終更新**: 2025-12-15
**ステータス**: 復旧作業開始

---

## 至上命題 - セッション開始時に必ず確認

### 絶対に守るルール

#### 1. gitコミット・デプロイフロー（最重要）

**ユーザーが変更を承認したら即座にコミットする**

```bash
# 承認後すぐに実行
git add -A
git commit -m "$(cat <<'EOF'
[承認済み] 変更内容の説明

- 具体的な変更点

Approved by user

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

**本番デプロイフロー**:
1. ユーザーが変更を承認
2. 即座に `git add && git commit`
3. 「本番デプロイしますか？」と確認
4. 承認後 `git push origin main`

**禁止コマンド**:
- `git checkout -- ファイル名` ← 今回の災害の原因
- `git reset --hard`
- `git clean -fd`
- `git push --force`

#### 2. エラーログの即時記録

- 問題が発生したら**即座に**エラーログに記録
- ユーザーから指摘されたら**最優先で**記録
- 「あとで記録しよう」は**絶対に許されない**
- どうやってエラーを回避したかを必ず記録

#### 3. 実装ロジックの記録

- どうやって実現させたかをTODOファイルに記録
- 変更した関数名、行番号を明記
- 将来の参照のため詳細に記録

#### 4. 作業前チェックリスト

1. **開発環境URL確認**: `http://localhost:3000/index-kanban.html`
   - `sales-task-core/` は不要！
2. **既存機能の動作確認を必ず行う**
3. **変更の影響範囲を明示する**
4. **一度に1つの機能のみ変更する**
5. **変更後に基本動作テストを実施する**

#### 5. 基本動作テスト項目

- [ ] タスクカードのドラッグ&ドロップ
- [ ] タスクの作成・編集・削除
- [ ] フィルター切り替え
- [ ] 設定画面の表示
- [ ] ログイン・ログアウト

---

## 現在のコード状態

```javascript
// 現在のバージョン（11月20日版に戻った）
const APP_VERSION = '2025-11-20-v8-hide-management-id';
```

- ファイルサイズ: 14,160行
- タイトル: `営業タスク管理 - Kanbanボード`

---

## 復旧計画（1週間以内に完了）

### 消失した12月の変更一覧

| # | 日付 | 消失した変更 | 参照資料 | 優先度 |
|---|------|-------------|---------|--------|
| 1 | 12/01 | UI/UX Phase 1（絵文字削除、中央揃え、設定モーダル最適化） | handover/requirements/2025-12-01-ui-enhancement-phase1.md | 高 |
| 2 | 12/01 | 統計ロジック14箇所修正 | TODO-v006 | 高 |
| 3 | 12/02 | カラムシステム改善（isDoneColumn/isTrashColumn） | design/column-system-redesign-2025-12-02.md | 高 |
| 4 | 12/04 | プロジェクトタスク増殖バグ修正 | error-logs/2025-12-04-project-task-duplication-fix.md | 高 |
| 5 | 12/08 | 「ゴミ箱」→「アーカイブ」リネーム | error-logs/2025-12-08-trash-to-archive-rename.md | 中 |
| 6 | 12/08 | 「営業タスク管理」→「Kanban Work」命名変更 | TODO-v008 | 中 |
| 7 | 12/08 | OCR機能完全削除（約1,500行） | error-logs/2025-12-08-ocr-feature-removal.md | 中 |
| 8 | 12/08 | ヘルプモーダル実装 | TODO-v008 | 中 |
| 9 | 12/08 | kanbanColumns Firestore移行 | design/user-column-customization-2025-12-08.md | 高 |
| 10 | 12/09 | マイページ統計修正 | TODO-v009 | 中 |
| 11 | 12/11 | TERRAブランディング適用 | TODO-v010 | 中 |
| 12 | 12/11 | 楽観的UI更新実装 | TODO-v010 | 高 |
| 13 | 12/11 | レガシーコード54行削除 | TODO-v010 | 低 |
| 14 | 12/15 | ユーザーごとカラムカスタマイズ | TODO-v011, design/user-column-customization-2025-12-08.md | 高 |
| 15 | 12/15 | ログイン時自動表示対象設定 | TODO-v011 | 高 |

### 復旧順序（推奨）

#### Phase 1: 基本機能復旧（最優先）

1. **「営業タスク管理」→「Kanban Work」命名変更**
   - タイトル、ヘッダー、コメント等

2. **統計ロジック14箇所修正**
   - isDoneColumn() / isTrashColumn()の修正
   - 参照: TODO-v006

3. **プロジェクトタスク増殖バグ修正**
   - 参照: error-logs/2025-12-04-project-task-duplication-fix.md

#### Phase 2: UI/UX改善

4. **UI/UX Phase 1**
   - 絵文字削除
   - 中央揃え統一
   - 設定モーダル最適化
   - グラデーション、シャドウ、アニメーション
   - 参照: handover/requirements/2025-12-01-ui-enhancement-phase1.md

5. **「ゴミ箱」→「アーカイブ」リネーム**

6. **TERRAブランディング適用**

#### Phase 3: パフォーマンス・機能

7. **楽観的UI更新実装**
   - Firebase保存の非同期化

8. **OCR機能削除（約1,500行）**

9. **ヘルプモーダル実装**

#### Phase 4: Firestore移行・カスタマイズ

10. **kanbanColumns Firestore移行**
    - 参照: design/user-column-customization-2025-12-08.md

11. **ユーザーごとカラムカスタマイズ**

12. **ログイン時自動表示対象設定**

#### Phase 5: クリーンアップ

13. **マイページ統計修正**

14. **レガシーコード削除**

---

## 残りの要件（復旧後に対応）

### 至上命題: LocalStorage完全脱却

| データ | Firebase | LocalStorage | 状態 |
|-------|----------|--------------|------|
| タスク | OK | 不使用 | 完全移行済み |
| プロジェクト | OK | 不使用 | 完全移行済み |
| ユーザー情報 | OK | キャッシュ | 移行済み |
| kanbanColumns | OK | キャッシュ | 移行済み（要復旧） |
| currentSession | 未実装 | OK | **要移行** |
| taskTemplates | 未実装 | OK | **要移行** |
| recurringTemplates | 未実装 | OK | **要移行** |

### 中優先度

- チュートリアル機能の完成
- 加藤・朝日の管理者権限修正

### 延期・保留

- 全員表示でユーザーごとにグループ化表示
- カラムシステム再設計（設計完了、実装待機）

---

## 開発環境

```
開発環境: http://localhost:3000/index-kanban.html
本番環境: https://stellar-biscochitos-e19cb4.netlify.app/sales-task-core/index-kanban.html
```

**注意**: 開発環境に `sales-task-core/` は不要！

---

## 関連ファイル

### コード
- `sales-task-core/index-kanban.html` - メインコード
- `sales-task-core/firebase-config-auth-fix-20250819-132508.js` - Firebase設定

### 設計書（復旧時の参照用）
- `design/column-system-redesign-2025-12-02.md` - カラムシステム再設計
- `design/user-column-customization-2025-12-08.md` - ユーザーカラムカスタマイズ
- `handover/requirements/2025-12-01-ui-enhancement-phase1.md` - UI/UX Phase 1
- `handover/requirements/2025-11-20-comprehensive-requirements.md` - 包括的要件

### エラーログ（教訓）
- `error-logs/2025-12-15-git-checkout-disaster.md` - **今回の災害**
- `error-logs/2025-12-15-cache-stale-reading-problem.md` - キャッシュ問題
- `error-logs/2025-12-15-session-errors.md` - 連続障害記録
- `error-logs/2025-12-04-project-task-duplication-fix.md` - タスク増殖バグ
- `error-logs/2025-12-01-requirement-misunderstanding-text-alignment.md` - 要件理解失敗

---

## 12/15 教訓（絶対に忘れない）

### やってはいけないこと
1. `git checkout -- ファイル名` を実行する
2. 変更をコミットせずに作業を続ける
3. ユーザーから指摘された問題をエラーログに残さない
4. 影響範囲を確認せずにグローバルイベントリスナーを追加
5. 一度に複数の機能を変更
6. 変更後の基本動作テストを省略

### 今後の作業方針
1. **1つの機能を変更 → テスト → コミット → 次の機能**
2. **影響範囲を事前に明示**
3. **不明点はユーザーに確認**
4. **問題が起きたら即座にエラーログに記録**

---

## バージョン履歴

| バージョン | 日付 | 主な内容 |
|-----------|------|---------|
| v001-v003 | 11/19-20 | 初期要件定義 |
| v004 | 11/20 | 包括的要件定義（22項目） |
| v005 | 12/01 | UI/UX Phase 1完了 |
| v006 | 12/01-02 | 統計ロジック修正（14箇所） |
| v007 | 12/04 | タスク増殖バグ修正 |
| v008 | 12/08 | OCR削除、ヘルプモーダル、kanbanColumns移行 |
| v009 | 12/09 | マイページ統計修正 |
| v010 | 12/11 | TERRAブランディング、楽観的UI更新 |
| v011 | 12/15 | ユーザーごとカラムカスタマイズ |
| v012 | 12/15 | リバート後の至上命題まとめ |
| **v013** | **12/15** | **git checkout災害後の復旧計画** |

---

**最終更新**: 2025-12-15
**作成者**: Claude Code
**ステータス**: 復旧作業待ち
