# Kanban Work - TODO一覧

**バージョン**: v009
**作成日**: 2025-12-09
**最終更新**: 2025-12-09
**合計残作業時間**: 約27-40時間

---

## ⚠️ 次回セッション開始時の必読事項

### 必ず確認すべきファイル
1. **このファイル（TODO-v009）** - 最新の正式版
2. **エラーログ（error-logs/）** - 過去のミスと再発防止策
3. **設計書（design/, handover/design/）** - 未実装機能の設計

### 開発環境URL（重要）
```
開発環境: http://localhost:3000/index-kanban.html
本番環境: https://stellar-biscochitos-e19cb4.netlify.app/sales-task-core/index-kanban.html
```
※ 開発環境に `sales-task-core/` は不要！

---

## ✅ 完了済み（v008まで）

### 2025-12-11 完了
- ✅ **タスク作成時のアニメーション** - 新規タスクが3秒間拡大+青い影でハイライト表示
- ✅ **カラムヘッダーにミニプログレスバー** - 各カラムのタスク割合を白いバーで表示
- ✅ **統計サマリーのカード化** - カード型デザイン、グラデーション背景、ホバー効果
- ✅ **期限切れ・今日期限カードのクリック機能** - タスク一覧モーダル表示

### 2025-12-09 完了
- ✅ **プロジェクトカラム移動ボタン不具合修正** - 右クリックメニュー対応
- ✅ **Slack通知のカラム名表示修正** - `getColumnNameById()`のprojectId解析修正
- ✅ **タスク作成モーダル改善**
  - プロジェクト選択→カラム選択の順序に変更
  - プロジェクトタスクで非表示オプションをグレーアウト
  - 非表示チェック時はプロジェクト選択を無効化
  - プロジェクト選択とカラム選択を横並びに
- ✅ **ハンバーガーメニューのログ削除**
- ✅ **プロジェクト一覧にタイムスタンプ表示** - サイドパネルに作成日を表示
- ✅ **マイページの個人詳細統計修正** - completedAt優先、assignee対応、プロジェクトタスク対応、親ウィンドウからpostMessageでタスクデータ受信

### 2025-12-08 完了
- ✅ **「ゴミ箱」→「アーカイブ」リネーム**
- ✅ **「営業タスク管理」→「Kanban Work」に変更**
- ✅ **ヘッダー・サイドバーUI整理**
- ✅ **OCR機能完全削除**
- ✅ **ヘルプモーダル実装**（チュートリアル・機能一覧・FAQ）
- ✅ **kanbanColumns Firestore移行完了**

### 2025-12-04 完了
- ✅ **プロジェクトタスク増殖バグ修正**
- ✅ **通常タスクのアーカイブカラム削除保護を追加**

### 2025-12-02 完了
- ✅ **加藤・朝日の管理者権限修正**
- ✅ **統計ロジック全体修正**（14箇所）
- ✅ **ダッシュボード統計ロジック確認**

### 2025-12-01 完了
- ✅ **UI/UX Phase 1完了**（絵文字削除、中央揃え、設定モーダル等）
- ✅ **コメントメンション通知修正**
- ✅ **全データ削除ボタン修正**
- ✅ **カラム追加即時反映修正**
- ✅ **複数選択削除機能** - 実装確認済み
- ✅ **プロジェクト公開設定** - 実装確認済み
- ✅ **新規タスク・複数選択ボタン配置**

### 2025-11-20以前 完了
- ✅ プロジェクトタスクのDONE/TRASH機能完全実装
- ✅ 完了・ゴミ箱への移動時アラート修正
- ✅ プロジェクト編集モーダルの×ボタン修正
- ✅ 完了カラムのタスクが期限切れで赤くなる問題を修正
- ✅ ゴミ箱の180日後自動削除機能をプロジェクトタスクにも対応
- ✅ Firebase認証・ログイン問題解決
- ✅ E2Eテスト実装（Playwright）

---

## 🔴🔴🔴 最優先（至上命題）

### 1. LocalStorage完全脱却プロジェクト **(3-5時間)**

**ユーザーコメント**: 「至上命題です。超重要です。」
**⚠️ 注意**: これまでエラーが多かった箇所のため、他のタスクを先に片付けてから最後に対応すること。

| データ | Firebase | LocalStorage | 状態 |
|-------|----------|--------------|------|
| タスク | ✅ | ❌ | 完全移行済み |
| プロジェクト | ✅ | ❌ | 完全移行済み |
| ユーザー情報 | ✅ | ⚠️ キャッシュ | 移行済み |
| kanbanColumns | ✅ | ⚠️ キャッシュ | 移行済み（12/08） |
| currentSession | ❌ | ✅ | **要移行** |
| taskTemplates | ❌ | ✅ | **要移行** |
| recurringTemplates | ❌ | ✅ | **要移行** |

---

## 🔴 高優先度

### 2. タスク作成と移動が重い **(3-5時間)**
- **初出**: v004（2025-11-20）
- ドラッグ&ドロップ時に `[Violation] 'drop' handler took 2574ms`
- 対応: Firebase保存の非同期化、楽観的UI更新

### ~~3. ユーザー追加時のセッション上書き問題~~ ❌ 放棄
- **初出**: v004（2025-11-20）
- ユーザー追加後、自動でそのユーザーにログインされてしまう
- **放棄理由**: Firebase Authの`createUserWithEmailAndPassword`が新規ユーザーで自動ログインする仕様。フロントエンドだけでは防止不可。Firebase Admin SDK（サーバーサイド）導入時に再検討

### ~~4. プロジェクト一覧にタイムスタンプ表示~~ ✅ 完了（2025-12-09）
- サイドパネルのプロジェクト一覧に作成日を表示

### 5. ユーザーごとカラムカスタマイズ **(大規模・要検証)**
- **初出**: v008（2025-12-08）
- **設計書**: `design/user-column-customization-2025-12-08.md`
- 各ユーザーが自分専用のカラム構成を設定
- 「全員」表示時は固定3カラム（未完了一覧・完了・アーカイブ）

---

## 🟡 中優先度

### ~~6. マイページの個人詳細統計~~ ✅ 完了（2025-12-09）
- `completedAt`を優先使用するよう修正
- `assignees`と`assignee`の両方に対応
- プロジェクトタスクの完了カラム判定を追加

### 7. チュートリアル機能の完成 **(2-3時間)**
- **初出**: v009（2025-12-09）
- ヘルプモーダルは実装済みだが内容の充実が必要
- 最後に対応予定

---

## 🎨 UI/UX Phase 2（最後の仕上げ）

### ~~10. カラムヘッダーにミニプログレスバー~~ ❌ 取り下げ（2025-12-11）
- 実装後、ユーザーから不要との判断で削除

### ~~11. 統計サマリーのカード化~~ ✅ 完了（2025-12-11）
- カード型デザイン、グラデーション背景、ホバー効果、クリックで詳細表示

### ~~12. タスク作成時のアニメーション~~ ✅ 完了（2025-12-11）
- 新規タスクが3秒間拡大+青い影でハイライト表示

### ~~13. カラーテーマ切り替え~~ ✅ 完了（2025-12-11）
- 6種類のテーマ（ライト、ダーク、ピンク、グリーン、ブルー、パープル）
- ユーザーごとにFirebaseに保存
- ヘッダー・プロジェクト一覧・看板画面で統一されたスタイル

---

## 📋 延期・保留

### カラムシステム再設計
- **設計書**: `design/column-system-redesign-2025-12-02.md`
- **状態**: 設計完了、実装延期
- **実装タイミング**: カラム名変更で統計が壊れる問題が発生した時
- **現状の保護**: パターンマッチで認識（isDoneColumn, isTrashColumn）

---

## 📊 作業時間見積もり

| 優先度 | 時間 |
|-------|------|
| 🔴🔴🔴 最優先（至上命題） | 3-5時間 |
| 🔴 高優先度 | 3-5時間 |
| 🟡 中優先度 | 2-3時間 |
| 🎨 UI/UX Phase 2 | 5-7時間 |
| **総合計** | **約13-20時間** |

---

## ⚠️ デプロイフロー

1. **開発環境でテスト**: `http://localhost:3000/index-kanban.html`
2. **ユーザーのGOを待つ**
3. **本番デプロイ**: `git push origin main`

---

## 📁 関連ファイル

### コード
- **メインコード**: `sales-task-core/index-kanban.html`
- **Firebase設定**: `sales-task-core/firebase-config-auth-fix-20250819-132508.js`
- **Slack通知**: `sales-task-core/slack-proxy.js`

### 設計書
- `design/column-system-redesign-2025-12-02.md` - カラムシステム再設計
- `design/user-column-customization-2025-12-08.md` - ユーザーカラムカスタマイズ

### エラーログ
- `error-logs/2025-12-08-ocr-feature-removal.md`
- `error-logs/2025-12-08-trash-to-archive-rename.md`
- `error-logs/2025-12-04-project-task-duplication-fix.md`
- `error-logs/2025-12-04-wrong-dev-url-repeated-mistake.md`
- `error-logs/2025-12-02-statistics-logic-column-detection-fix.md`
- `error-logs/2025-12-01-requirement-misunderstanding-text-alignment.md`
- `error-logs/2025-12-01-css-not-applying-inline-style-override.md`

---

## バージョン履歴

| バージョン | 日付 | 主な変更 |
|-----------|------|---------|
| v001-v003 | 11/19-20 | 初期要件定義 |
| v004 | 11/20 | 包括的要件定義（22項目） |
| v005 | 12/01 | UI/UX Phase 1完了 |
| v006 | 12/01-02 | ユーザーフィードバック反映、統計ロジック修正 |
| v007 | 12/04 | タスク増殖バグ修正、カラム保護強化 |
| v008 | 12/08 | アーカイブ化、Kanban Work命名、ヘルプ実装 |
| **v009** | **12/09** | **全タスク棚卸し、設計書未実装分追加、正確な見積もり** |

---

**最終更新**: 2025-12-11
**作成者**: Claude Code
**ステータス**: ✅ 最新版
