# Firestoreãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸çµ±ä¸€ - å•é¡Œãªã—ç¢ºèªæ¸ˆã¿

**æ—¥ä»˜**: 2025-12-02
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… èª¿æŸ»å®Œäº† - å•é¡Œãªã—
**é‡è¦åº¦**: ğŸ“˜ æƒ…å ± (å•é¡Œã§ã¯ãªã„)

---

## ğŸ” ç™ºè¦‹ã•ã‚ŒãŸç¾è±¡

Firestore (`users` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³) ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ§‹æˆãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„ã€‚

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: Firebase Authç›´æ¥ä½œæˆ (çŸ­ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³)
```
createdAt, displayName, email, isActive, role, uid, updatedAt
```

**ä¾‹**: é‚¨ä¸­å¤©çœŸ
- `displayName`: "é‚¨ä¸­å¤©çœŸ"
- `isActive`: true
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ•°: 7å€‹

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: user-management.htmlçµŒç”±ä½œæˆ (é•·ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³)
```
createdAt, department, email, id, isDisabled, isHidden, name, restoredAt, role, uid, updatedAt
```

**ä¾‹**: ãƒ†ã‚¹ãƒˆãƒ‘ã‚¤ãƒ­ãƒƒãƒˆ
- `name`: "ãƒ†ã‚¹ãƒˆãƒ‘ã‚¤ãƒ­ãƒƒãƒˆ"
- `isDisabled`: false
- `isHidden`: false
- `restoredAt`: "2025-11-13T02:41:42.917Z"
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ•°: 11å€‹

---

## ğŸ¯ èª¿æŸ»çµæœ: å•é¡Œãªã—

### ç†ç”±1: ã‚³ãƒ¼ãƒ‰ãŒãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸ä¸€è‡´ã‚’å¸åã—ã¦ã„ã‚‹

**user-management.html:874 ã®æ­£è¦åŒ–å‡¦ç†**
```javascript
return {
    id: user.uid || user.id,
    name: user.displayName || user.name,  // â† displayName ã¨ name ã®ä¸¡æ–¹ã«å¯¾å¿œ
    email: user.email,
    role: correctRole,
    department: user.department || '-',
    createdAt: user.createdAt,
    uid: user.uid || user.id,
    isDisabled: user.isDisabled || false,  // â† å­˜åœ¨ã—ãªã„å ´åˆã¯ false
    isHidden: user.isHidden || false,      // â† å­˜åœ¨ã—ãªã„å ´åˆã¯ false
    disabledAt: user.disabledAt,
    disabledBy: user.disabledBy,
    hiddenAt: user.hiddenAt,
    hiddenBy: user.hiddenBy
};
```

### ç†ç”±2: æ“ä½œå±¥æ­´ã«åŸºã¥ãå‹•çš„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ã¯æ­£å¸¸ãªè¨­è¨ˆ

ä»¥ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦ç‰¹å®šã®æ“ä½œã‚’è¡Œã£ãŸæ™‚ã®ã¿è¿½åŠ ã•ã‚Œã‚‹:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | è¿½åŠ ã‚¿ã‚¤ãƒŸãƒ³ã‚° | ã‚³ãƒ¼ãƒ‰å‚ç…§ |
|-----------|--------------|-----------|
| `isDisabled`, `disabledAt`, `disabledBy` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç„¡åŠ¹åŒ–ã—ãŸæ™‚ | user-management.html:1104-1107 |
| `isHidden`, `hiddenAt`, `hiddenBy` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’éè¡¨ç¤ºåŒ–ã—ãŸæ™‚ | user-management.html:1108-1109 |
| `updatedAt` | ãƒ­ãƒ¼ãƒ«ã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸæ™‚ | user-management.html:1006, 1047 |
| `restoredAt`, `restoredBy` | ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å¾©å…ƒã—ãŸæ™‚ | user-management.html:1181-1182 |

**ã“ã‚Œã¯æ­£å¸¸ãªè¨­è¨ˆ**:
- âœ… æ“ä½œå±¥æ­´ãŒè‡ªå‹•çš„ã«è¨˜éŒ²ã•ã‚Œã‚‹
- âœ… ä¸è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒãŸãªã„ï¼ˆãƒ¡ãƒ¢ãƒªåŠ¹ç‡ï¼‰
- âœ… `|| false` ã‚„ `|| defaultValue` ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ¬ å¦‚ã«å¯¾å¿œ

---

## ğŸ“Š ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸ä¸€è‡´ã®åŸå› 

### 1. displayName vs name
- **displayName**: Firebase AuthåˆæœŸè¨­å®šæ™‚ã«è‡ªå‹•ä½œæˆã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼
- **name**: user-management.html ã‹ã‚‰æ‰‹å‹•ä½œæˆã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼
- **å¯¾å¿œ**: ã‚³ãƒ¼ãƒ‰ã§ `user.displayName || user.name` ã«ã‚ˆã‚Šå¸åæ¸ˆã¿

### 2. isActive vs isDisabled/isHidden
- **isActive**: Firebase Authã®åˆæœŸè¨­å®šï¼ˆå¤ã„è¨­è¨ˆã®å¯èƒ½æ€§ï¼‰
- **isDisabled/isHidden**: ç¾åœ¨ã®è¨­è¨ˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰
- **å¯¾å¿œ**: ã‚³ãƒ¼ãƒ‰ã§ `user.isDisabled || false` ã«ã‚ˆã‚Šãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¸ˆã¿

### 3. å‹•çš„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (restoredAt, updatedAt, disabledAt ãªã©)
- **åŸå› **: æ“ä½œå±¥æ­´ã«åŸºã¥ã„ã¦å‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹
- **å¯¾å¿œ**: ã‚³ãƒ¼ãƒ‰ã§ `user.restoredAt` (undefined ã§ã‚‚å•é¡Œãªã—) ã«ã‚ˆã‚Šå¸åæ¸ˆã¿

---

## âœ… çµè«–

### ç¾çŠ¶
- **å•é¡Œãªã—** - ã‚³ãƒ¼ãƒ‰ã¯æŸ”è»Ÿã«è¨­è¨ˆã•ã‚Œã¦ãŠã‚Šã€Firestoreã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸ä¸€è‡´ã‚’å®Œå…¨ã«å¸å
- **å‹•ä½œæ­£å¸¸** - å¤ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ (`displayName`) ã¨æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ (`name`) ãŒå…±å­˜å¯èƒ½
- **ä¿å®ˆæ€§è‰¯å¥½** - å°†æ¥çš„ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¦ã‚‚ `|| defaultValue` ã§å¯¾å¿œå¯èƒ½

### å¯¾å¿œä¸è¦
âŒ Firestoreãƒ‡ãƒ¼ã‚¿ã®æ­£è¦åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ - ä¸è¦
âŒ çµ±ä¸€ã‚¹ã‚­ãƒ¼ãƒã¸ã®ç§»è¡Œ - ä¸è¦
âœ… **ç¾çŠ¶ç¶­æŒ** - ã‚³ãƒ¼ãƒ‰å´ã§å®Œå…¨ã«å¸åã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä¿®æ­£ä¸è¦

---

## ğŸ“ ä»Šå¾Œã®å‚è€ƒ

ã‚‚ã—å°†æ¥çš„ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸ä¸€è‡´ã§å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã‚’ç¢ºèª:
1. `user-management.html:874` ã®æ­£è¦åŒ–å‡¦ç†ãŒå‰Šé™¤ã•ã‚Œã¦ã„ãªã„ã‹
2. æ–°ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ãŸéš›ã« `|| defaultValue` ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¨­å®šã—ãŸã‹
3. `displayName` ã¨ `name` ã®ä¸¡æ–¹ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹

---

**ä½œæˆæ—¥**: 2025-12-02
**ä½œæˆè€…**: Claude Code
**ç¢ºèªè€…**: é‚¨ä¸­å¤©çœŸ
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å•é¡Œãªã—ç¢ºèªæ¸ˆã¿
