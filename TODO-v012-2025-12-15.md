# Kanban Work - TODO一覧

**バージョン**: v012
**作成日**: 2025-12-15
**最終更新**: 2025-12-15
**ステータス**: 12/15セッションの破壊的変更をリバート後

---

## 至上命題 - 必ず確認してから作業開始

### 作業前チェックリスト
1. **既存機能の動作確認を必ず行う**
2. **変更の影響範囲を明示する**
3. **一度に1つの機能のみ変更する**
4. **変更後に基本動作テストを実施する**

### 基本動作テスト項目
- [ ] タスクカードのドラッグ&ドロップ
- [ ] タスクの作成・編集・削除
- [ ] フィルター切り替え
- [ ] 設定画面の表示
- [ ] ログイン・ログアウト

---

## 12/15セッション リバート内容

以下の変更をすべてリバートしました：
- ユーザー名取得ロジックの変更
- カラム移動権限の変更
- 設定画面ドラッグ&ドロップのマウスイベント化
- 初期カラムの変更
- プロジェクト設定画面のドラッグ&ドロップ変更

**理由**: 既存機能（タスクのドラッグ&ドロップ）を破壊したため

---

## 至上命題TODO

### 1. LocalStorage完全脱却 **(3-5時間)**

**ユーザーコメント**: 「至上命題です。超重要です。」

| データ | Firebase | LocalStorage | 状態 |
|-------|----------|--------------|------|
| タスク | OK | ❌ | 完全移行済み |
| プロジェクト | OK | ❌ | 完全移行済み |
| ユーザー情報 | OK | キャッシュ | 移行済み |
| kanbanColumns | OK | キャッシュ | 移行済み |
| currentSession | ❌ | OK | **要移行** |
| taskTemplates | ❌ | OK | **要移行** |
| recurringTemplates | ❌ | OK | **要移行** |

### 2. ユーザーごとカラムカスタマイズの未解決問題

| # | 問題 | 状態 |
|---|------|------|
| 1 | カラム作成後、画面更新しないと追加されない | ❌ 未解決 |
| 2 | ログインし直すとカラム追加が消える | ❌ 未解決 |
| 3 | フルネーム表示だとカラム変更に画面更新必要 | ❌ 未解決 |

### 3. ログイン時の自動表示対象設定

- Firestoreの`users`コレクションから名前を取得（ハードコード廃止）
- ログイン後、自動的に自分を表示対象に設定
- **注意**: `nameMap`のハードコードは削除し、`systemUsers`から取得する

### 4. 設定画面のカラム移動機能

- 現状: 動作しない（inline event handler問題）
- **注意**: マウスイベント化する場合、既存のタスクドラッグに影響しないよう注意

### 5. プロジェクト選択時の表示対象

- 要件: プロジェクト名のみ表示（「プロジェクト名 - ユーザー名」ではなく）
- 要件: プロジェクト選択中はフィルター変更不可

### 6. 初期カラムの変更

- 要件: TODO → Phase1 → Phase2 → Phase3 → Done → Archive
- **注意**: 内部IDは既存タスクとの互換性を維持

### 7. プロジェクト設定画面のカラム移動

- 新規プロジェクト作成時
- 既存プロジェクト編集時

---

## 中優先度

### チュートリアル機能の完成 **(2-3時間)**
- ヘルプモーダルは実装済みだが内容の充実が必要

---

## 延期・保留

### 全員表示でユーザーごとにグループ化表示
- 検討中だが優先度低

### カラムシステム再設計
- 設計書: `design/column-system-redesign-2025-12-02.md`
- 実装タイミング: カラム名変更で統計が壊れる問題が発生した時

---

## 開発環境URL

```
開発環境: http://localhost:3000/index-kanban.html
本番環境: https://stellar-biscochitos-e19cb4.netlify.app/sales-task-core/index-kanban.html
```
※ 開発環境に `sales-task-core/` は不要！

---

## デプロイフロー

1. **開発環境でテスト**: `http://localhost:3000/index-kanban.html`
2. **基本動作テストをすべて実施**
3. **ユーザーのGOを待つ**
4. **本番デプロイ**: `git push origin main`

---

## 12/15 教訓

### やってはいけないこと
1. 影響範囲を確認せずにグローバルイベントリスナーを追加
2. 一度に複数の機能を変更
3. 変更後の基本動作テストを省略
4. ユーザーの要件を確認せずに突っ走る

### 今後の作業方針
1. **1つの機能を変更 → テスト → 確認 → 次の機能**
2. **影響範囲を事前に明示**
3. **不明点はユーザーに確認**

---

## 関連ファイル

### コード
- `sales-task-core/index-kanban.html`
- `sales-task-core/firebase-config-auth-fix-20250819-132508.js`

### エラーログ
- `error-logs/2025-12-15-session-errors.md` - 本日の連続障害記録
- `error-logs/2025-12-15-username-mismatch-bug.md`

---

**最終更新**: 2025-12-15
**作成者**: Claude Code
**ステータス**: リバート完了、再実装待ち
