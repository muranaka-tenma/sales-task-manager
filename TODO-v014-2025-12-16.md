# Kanban Work - TODO一覧

**バージョン**: v014
**作成日**: 2025-12-16
**最終更新**: 2025-12-16
**ステータス**: 復旧作業継続中

---

## 最重要: 次のエージェントへの引き継ぎ

### 必ず最初に読むファイル
1. **このファイル (TODO-v014)**
2. **error-logs/2025-12-16-session-handover-critical.md**
3. **error-logs/2025-12-15-git-checkout-disaster.md**

### ユーザーの感情
- **非常に怒っている**
- 2025-12-15にgit checkoutで1ヶ月分の作業が消失
- 2025-12-16セッションでも進捗が遅く、全体像を把握していなかった
- 「金輪際同じミスを繰り返さないように」と明確に警告

### 絶対に守ること
1. **破壊的gitコマンド禁止**: `git checkout --`, `git reset --hard`, `git clean -fd`, `git push --force`
2. **変更したらすぐコミット**
3. **セッション開始時にTODO/エラーログを全て読む**

### マスタールール: ドキュメント記録の徹底
1. **Vシリーズ（TODOファイル）**: 成功例を記録
   - ユーザーが満足した実装内容
   - 承認された変更の詳細
   - 効果的だったアプローチ

2. **エラーログ**: 失敗例と解決例を記録
   - 発生した問題の詳細
   - 根本原因の分析
   - 解決方法と再発防止策

3. **記録タイミング**: 逐一記入を徹底
   - 成功したらすぐVシリーズに追記
   - 失敗したらすぐエラーログに追記
   - 後回しにしない

---

## 至上命題 - セッション開始時に必ず確認

### 絶対に守るルール

#### 1. gitコミット・デプロイフロー（最重要）

**ユーザーが変更を承認したら即座にコミットする**

```bash
# 承認後すぐに実行
git add -A
git commit -m "$(cat <<'EOF'
[承認済み] 変更内容の説明

- 具体的な変更点

Approved by user

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

**禁止コマンド**:
- `git checkout -- ファイル名` ← 12/15災害の原因
- `git reset --hard`
- `git clean -fd`
- `git push --force`

#### 2. 作業前チェックリスト

1. **開発環境URL確認**: `http://localhost:3000/index-kanban.html`
   - `sales-task-core/` は不要！
2. **既存機能の動作確認を必ず行う**
3. **変更の影響範囲を明示する**
4. **一度に1つの機能のみ変更する**
5. **変更後に基本動作テストを実施する**

---

## 現在の進捗（2025-12-16時点）

### 完了（17/36）
| # | 項目 | 完了日 |
|---|------|--------|
| 1 | 統計ロジック14箇所修正（isDoneColumn/isTrashColumn） | 12/16 |
| 2 | TERRAブランディング色調整（#026aa7→#0097A7） | 12/16 |
| 3 | 楽観的UI更新実装（ドラッグ&ドロップ、タスク作成） | 12/16 |
| 4 | 統計カードに完了率・期限遵守率追加 | 12/16 |
| 5 | プロジェクトタスク増殖バグ修正 | 12/16 |
| 6 | 分析サマリーバー重複削除 | 12/16 |
| 7 | APP_VERSION更新（v2-recovery-phase2） | 12/16 |
| 8 | Phase 1: 命名・コメント統一（ゴミ箱→アーカイブ13箇所） | 12/16 |
| 9 | Phase 2: UI/UX改善（絵文字削除30箇所以上） | 12/16 |
| 10 | Phase 3: TERRAブランディング（Base64ロゴ埋め込み） | 12/16 |
| 11 | Phase 4: kanbanColumns Firestore移行（getColumns/saveColumns復旧） | 12/16 |
| 12 | Phase 4: OCR完全削除（残存コード削除） | 12/16 |
| 13 | Phase 5: マイページ統計postMessage修正 | 12/16 |
| 14 | Phase 6: ハンバーガーメニューログ削除 | 12/16 |
| 15 | 加藤・朝日のadmin権限設定（コード内設定済み） | 12/16 |
| 16 | テキストインポートメニュー名称変更 | 12/16 |
| 17 | APP_VERSION更新（v5-columns-firestore） | 12/16 |

### 現在のコード状態
```javascript
const APP_VERSION = '2025-12-16-v5-columns-firestore';
```

---

## 残り復旧項目（29項目）- 要件検証済み

### 実装計画（7フェーズ）

| Phase | 内容 | リスク | 項目数 |
|-------|------|--------|--------|
| 1 | 命名・コメント統一 | 低 | 2 |
| 2 | UI/UX改善 | 中 | 10 |
| 3 | TERRAブランディング | 中 | 3 |
| 4 | 機能実装 | **高** | 6 |
| 5 | バグ修正 | 高 | 4 |
| 6 | クリーンアップ | 低 | 3 |
| 7 | 最終検証 | - | 1 |

---

### Phase 1: 命名・コメント統一（低リスク）

#### 「ゴミ箱→アーカイブ」コメント変更（13箇所）
| 行番号 | 変更内容 |
|--------|---------|
| 3637 | ゴミ箱カラム → アーカイブカラム |
| 3645 | ゴミ箱カラム → アーカイブカラム |
| 6009 | ゴミ箱移動時 → アーカイブ移動時 |
| 6106 | ゴミ箱から復元 → アーカイブから復元 |
| 6114 | ゴミ箱から復元 → アーカイブから復元 |
| 6604 | ゴミ箱スタイル用 → アーカイブスタイル用 |
| 6651 | ゴミ箱カラム → アーカイブカラム |
| 10930 | ゴミ箱移動 → アーカイブ移動 |
| 10954 | ゴミ箱に移動 → アーカイブに移動 |
| 10964 | ゴミ箱の自動削除 → アーカイブの自動削除 |
| 10978 | ゴミ箱の自動クリーンアップ → アーカイブの自動クリーンアップ |
| 10983 | ゴミ箱 → アーカイブ |
| 11732 | ゴミ箱カラム → アーカイブカラム |

※ パターンマッチ用（Line 3215, 11565, 11734）は互換性維持のため変更不要

#### 「営業タスク管理→Kanban Work」
- index-kanban.html: 変更済み
- **my-profile.html**: Line 837 のみ要変更

---

### Phase 2: UI/UX改善（中リスク）

| # | 項目 | 詳細 |
|---|------|------|
| 1 | 絵文字完全削除 | 30箇所以上（📁🔒✅🌐🔴🟡🟢等） |
| 2 | ステータス表示テキスト化 | 🌐公開→[公開]、🔒非公開→[非公開] |
| 3 | 全要素中央揃え | CSS text-align: center |
| 4 | 設定モーダル最適化 | max-width: 600px、グリッド |
| 5 | ボタンサイズ統一 | !important適用 |
| 6 | カラムカウンター | 背景#0097A7、文字白 |
| 7 | グラデーション・シャドウ | カラムヘッダー、タスクカード |
| 8 | ×ボタン視認性 | 灰色背景+ボーダー |
| 9 | タスク作成アニメーション | 3秒間ハイライト |
| 10 | 統計サマリーカード化 | グラデーション、ホバー効果 |

---

### Phase 3: TERRAブランディング（中リスク）

| # | 項目 | 詳細 |
|---|------|------|
| 1 | TERRAロゴPNG埋め込み | Base64エンコード、白色フィルター |
| 2 | ユーザー名表示 | Firestore `users.name`取得、右上表示 |
| 3 | 右パネルユーザー情報非表示 | display: none |

---

### Phase 4: 機能実装（高リスク）

| # | 項目 | 詳細 |
|---|------|------|
| 1 | ヘルプモーダル | タブ切替、スポットライトチュートリアル |
| 2 | kanbanColumns Firestore移行 | FirebaseDB.getColumns/saveColumns復旧 |
| 3 | ユーザーごとカラムカスタマイズ | users/{userId}/settings/columns |
| 4 | **カラムカスタマイズバグ修正** | v011の3バグを修正版で実装 |
| 5 | ログイン時自動表示対象設定 | Firestore users取得 |
| 6 | OCR完全削除確認 | 残存コード検索 |

#### カラムカスタマイズバグ（v011で未解決→修正版実装必須）
1. カラム作成後、画面更新しないと追加されない
2. 他者表示に切り替えるとログインし直すと消える
3. フルネーム表示対象だと画面更新が必要

---

### Phase 5: バグ修正（高リスク）

| # | 項目 | 詳細 |
|---|------|------|
| 1 | カラム削除時タスクチェック | 他ユーザータスク除外 |
| 2 | 統計フィルター連動 | 表示対象切替時に統計更新 |
| 3 | Slack通知カラム名 | getColumnNameById()使用確認 |
| 4 | マイページ統計 | postMessage方式（error-logs参照） |

---

### Phase 6: クリーンアップ（低リスク）

| # | 項目 | 詳細 |
|---|------|------|
| 1 | レガシーコード削除 | migrateProjectsToFirebase等54行 |
| 2 | ログ削除 | ハンバーガーメニューconsole.log |
| 3 | 権限修正 | 加藤・朝日をFirestoreでadminに |

#### 加藤・朝日の情報
- `kato-jun@terracom.co.jp` → admin
- `asahi-keiichi@terracom.co.jp` → admin

---

### Phase 7: 最終検証

- [ ] タスクCRUD
- [ ] ドラッグ&ドロップ
- [ ] フィルター
- [ ] 統計
- [ ] Slack通知
- [ ] カラムカスタマイズ

---

## LocalStorage完全脱却（至上命題）

| データ | Firebase | LocalStorage | 状態 |
|-------|----------|--------------|------|
| タスク | OK | 不使用 | 完全移行済み |
| プロジェクト | OK | 不使用 | 完全移行済み |
| ユーザー情報 | OK | キャッシュ | 移行済み |
| kanbanColumns | OK | キャッシュ | 移行済み（要復旧） |
| currentSession | 未実装 | OK | **要移行** |
| taskTemplates | 未実装 | OK | **要移行** |
| recurringTemplates | 未実装 | OK | **要移行** |

---

## 開発環境

```
開発環境: http://localhost:3000/index-kanban.html
本番環境: https://stellar-biscochitos-e19cb4.netlify.app/sales-task-core/index-kanban.html
```

**注意**: 開発環境に `sales-task-core/` は不要！

---

## 関連ファイル

### コード
- `sales-task-core/index-kanban.html` - メインコード
- `sales-task-core/firebase-config-auth-fix-20250819-132508.js` - Firebase設定

### 設計書（復旧時の参照用）
- `design/column-system-redesign-2025-12-02.md` - カラムシステム再設計
- `design/user-column-customization-2025-12-08.md` - ユーザーカラムカスタマイズ
- `handover/requirements/2025-12-01-ui-enhancement-phase1.md` - UI/UX Phase 1
- `handover/requirements/2025-11-20-comprehensive-requirements.md` - 包括的要件

### エラーログ（必読）
- `error-logs/2025-12-16-requirements-validation-success.md` - **要件検証完了**
- `error-logs/2025-12-16-session-handover-critical.md` - **本セッションの引き継ぎ**
- `error-logs/2025-12-15-git-checkout-disaster.md` - **12/15災害**
- `error-logs/2025-12-15-cache-stale-reading-problem.md` - キャッシュ問題
- `error-logs/2025-12-04-project-task-duplication-fix.md` - タスク増殖バグ
- `error-logs/2025-12-09-mypage-stats-firebase-fix.md` - マイページ統計

---

## バージョン履歴

| バージョン | 日付 | 主な内容 |
|-----------|------|---------|
| v001-v003 | 11/19-20 | 初期要件定義 |
| v004 | 11/20 | 包括的要件定義（22項目） |
| v005 | 12/01 | UI/UX Phase 1完了 |
| v006 | 12/01-02 | 統計ロジック修正（14箇所） |
| v007 | 12/04 | タスク増殖バグ修正 |
| v008 | 12/08 | OCR削除、ヘルプモーダル、kanbanColumns移行 |
| v009 | 12/09 | マイページ統計修正 |
| v010 | 12/11 | TERRAブランディング、楽観的UI更新 |
| v011 | 12/15 | ユーザーごとカラムカスタマイズ |
| v012 | 12/15 | リバート後の至上命題まとめ |
| v013 | 12/15 | git checkout災害後の復旧計画 |
| **v014** | **12/16** | **復旧進捗7/36、要件検証完了、実装計画策定** |

---

**最終更新**: 2025-12-16
**作成者**: Claude Code / 拡張要件定義エンジニア
**ステータス**: 要件検証完了、実装計画策定済み（7/36完了）
**次のエージェントへ**: 拡張オーケストレーター(`@拡張オーケストレーター`)を起動してください
