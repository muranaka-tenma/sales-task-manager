# 営業タスク管理システム - TODO一覧

**バージョン**: v007
**作成日**: 2025-12-04
**最終更新**: 2025-12-04
**合計残作業時間**: 約12-18時間

---

## ⚠️ 次回セッション開始時の必読事項

### 必ず確認すべきファイル
1. **このファイル（TODO-v007）** - 最新の正式版
2. **エラーログ（error-logs/）** - 過去のミスと再発防止策
   - `2025-12-04-project-task-duplication-fix.md` - プロジェクトタスク増殖バグ修正
   - `2025-12-04-wrong-dev-url-repeated-mistake.md` - 開発環境URL繰り返しミス
   - `2025-12-02-statistics-logic-column-detection-fix.md` - 統計ロジック修正14箇所
   - `2025-12-01-requirement-misunderstanding-text-alignment.md` - 6回繰り返されても理解できなかった問題
   - `2025-12-01-css-not-applying-inline-style-override.md` - inline styleの詳細度問題

### 開発環境URL（重要）
```
開発環境: http://localhost:3000/index-kanban.html
本番環境: https://stellar-biscochitos-e19cb4.netlify.app/sales-task-core/index-kanban.html
```
※ 開発環境に `sales-task-core/` は不要！

---

## ✅ 本日完了（2025-12-04）

### 緊急バグ修正
- ✅ **プロジェクトタスク増殖バグ修正**
  - 原因: `saveTask()`内で`saveTasks()`と`createTask()`が二重呼び出し
  - 修正: `firebase-config-auth-fix-20250819-132508.js`, `index-kanban.html`
  - エラーログ: `error-logs/2025-12-04-project-task-duplication-fix.md`

- ✅ **通常タスクのゴミ箱カラム削除保護を追加**
  - 修正前: `done`カラムのみ削除不可
  - 修正後: `done`と`trash`両方削除不可
  - 行番号: 8104-8108

### カラムシステム検証
- ✅ **現行システムの安全性確認**
  - プロジェクトタスク: DONE/TRASHカラムは削除不可・編集不可 ✅
  - 通常タスク: DONE/TRASHカラムは削除不可 ✅（本日修正）
  - カラム並び替え: 未実装（UIアイコンのみ）→ 問題なし
  - 結論: **カラムシステム再設計は延期OK**

---

## 🔴🔴🔴 最優先（至上命題）

### 1. LocalStorage完全脱却プロジェクト **(3-5時間)**

**ユーザーコメント**: 「至上命題です。超重要です。」

| データ | Firebase | LocalStorage | 状態 |
|-------|----------|--------------|------|
| タスク | ✅ | ❌ | 完全移行済み |
| プロジェクト | ✅ | ❌ | 完全移行済み |
| ユーザー情報 | ✅ | ⚠️ キャッシュ | 移行済み |
| currentSession | ❌ | ✅ | **要移行** |
| taskTemplates | ❌ | ✅ | **要移行** |
| kanbanColumns | ❌ | ✅ | **要移行** |
| recurringTemplates | ❌ | ✅ | **要移行** |

---

## 🔴 高優先度

### 2. タスク作成と移動が重い **(3-5時間)**
- ドラッグ&ドロップ時に `[Violation] 'drop' handler took 2574ms`
- 対応: Firebase保存の非同期化、楽観的UI更新

### 3. ヘッダー・サイドバーのUI整理 **(1時間)**
- ヘッダーのユーザー名を削除
- サイドバーのユーザー情報を右上に移動

### 4. 新規タスク・複数選択ボタンの配置検討 **(30分-1時間)**

### 5. はてなボタンの機能更新 **(2時間)**
- マニュアル機能の実装

---

## 🟡 中優先度

### 6. ユーザー追加時のセッション上書き問題 **(1時間)**

### 7. マイページの個人詳細統計 **(1時間)**

### 8. ダッシュボード統計ロジック確認 **(30分)**
- ✅ 統計ロジック修正済み（2025-12-02）
- 追加確認が必要かチェック

---

## 🎨 UI/UX Phase 2（最後の仕上げ）

### 9. カラムヘッダーにミニプログレスバー **(1-2時間)**
### 10. 統計サマリーのカード化 **(2時間)**
### 11. タスク作成時のアニメーション **(1時間)**
### 12. カラーテーマ切り替え **(2-3時間)**
- LocalStorage脱却後に実装

---

## 📋 延期・保留

### カラムシステム再設計
- **設計ドキュメント**: `design/column-system-redesign-2025-12-02.md`
- **状態**: 設計完了、実装延期
- **実装タイミング**:
  - カラム並び替え機能を実装する時
  - カラム名変更で統計が壊れる問題が発生した時
- **現状の保護**:
  - プロジェクトタスク: `isRequiredColumn()`でパターンマッチ保護
  - 通常タスク: `id === 'done' || id === 'trash'`で保護

---

## 📊 作業時間見積もり

| 優先度 | 時間 |
|-------|------|
| 🔴🔴🔴 最優先（至上命題） | 3-5時間 |
| 🔴 高優先度 | 6.5-9時間 |
| 🟡 中優先度 | 2.5時間 |
| 🎨 UI/UX Phase 2 | 6-8時間 |
| **総合計** | **約12-18時間** |

---

## ⚠️ デプロイフロー

1. **開発環境でテスト**: `http://localhost:3000/index-kanban.html`
2. **ユーザーのGOを待つ**
3. **本番デプロイ**: `git push origin main`

---

## 📁 関連ファイル

- **本番URL**: https://stellar-biscochitos-e19cb4.netlify.app/sales-task-core/index-kanban.html
- **開発URL**: http://localhost:3000/index-kanban.html
- **メインコード**: `sales-task-core/index-kanban.html`
- **Firebase設定**: `sales-task-core/firebase-config-auth-fix-20250819-132508.js`
- **カラム設計**: `design/column-system-redesign-2025-12-02.md`

---

## バージョン履歴

| バージョン | 日付 | 主な変更 |
|-----------|------|---------|
| v001-v003 | 11/19-20 | 初期要件定義 |
| v004 | 11/20 | 包括的要件定義（22項目） |
| v005 | 12/01 | UI/UX Phase 1完了 |
| v006 | 12/01-02 | ユーザーフィードバック反映、統計ロジック修正 |
| **v007** | **12/04** | **タスク増殖バグ修正、カラム保護強化、システム検証完了** |

---

**最終更新**: 2025-12-04
**作成者**: Claude Code
**ステータス**: ✅ 最新版
