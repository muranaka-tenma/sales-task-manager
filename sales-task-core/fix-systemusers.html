<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ğŸ”§ systemUsersæ¨©é™ä¿®å¾©ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        .success { background: #4CAF50; color: white; }
        .danger { background: #f44336; color: white; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f2f2f2; }
    </style>
</head>
<body>
    <h1>ğŸ”§ systemUsersæ¨©é™ä¿®å¾©ãƒ„ãƒ¼ãƒ«</h1>
    
    <button onclick="showCurrentUsers()" class="success">ç¾åœ¨ã®systemUsersã‚’è¡¨ç¤º</button>
    <button onclick="fixUserRoles()" class="success">æ¨©é™ã‚’ä¿®å¾©</button>
    <button onclick="addMissingUser()" class="success">tamura-wataru ã‚’è¿½åŠ </button>
    
    <div id="current-users"></div>
    <div id="log"></div>
    
    <script>
        function log(message) {
            document.getElementById('log').innerHTML += message + '<br>';
            console.log(message);
        }
        
        function showCurrentUsers() {
            const users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
            
            let html = '<h2>ç¾åœ¨ã®systemUsersï¼ˆ' + users.length + 'åï¼‰</h2>';
            html += '<table><tr><th>ID</th><th>åå‰</th><th>ãƒ¡ãƒ¼ãƒ«</th><th>æ¨©é™</th><th>éƒ¨ç½²</th></tr>';
            
            users.forEach(user => {
                const roleColor = user.role === 'developer' ? '#e91e63' : 
                                user.role === 'admin' ? '#ff5722' : '#4caf50';
                html += `<tr>
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td style="color: ${roleColor}; font-weight: bold;">${user.role}</td>
                    <td>${user.department || '-'}</td>
                </tr>`;
            });
            
            html += '</table>';
            document.getElementById('current-users').innerHTML = html;
        }
        
        function fixUserRoles() {
            const users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
            let fixed = false;
            
            const correctRoles = {
                'muranaka-tenma@terracom.co.jp': 'developer',
                'kato-jun@terracom.co.jp': 'admin', 
                'asahi-keiichi@terracom.co.jp': 'admin',
                'hanzawa-yuka@terracom.co.jp': 'user',
                'tamura-wataru@terracom.co.jp': 'user',
                'hashimoto-yumi@terracom.co.jp': 'user',
                'fukushima-ami@terracom.co.jp': 'user'
            };
            
            users.forEach(user => {
                const correctRole = correctRoles[user.email];
                if (correctRole && user.role !== correctRole) {
                    log(`ğŸ”§ ${user.name}ã®æ¨©é™ã‚’${user.role}ã‹ã‚‰${correctRole}ã«ä¿®æ­£`);
                    user.role = correctRole;
                    fixed = true;
                }
            });
            
            if (fixed) {
                localStorage.setItem('systemUsers', JSON.stringify(users));
                log('âœ… æ¨©é™ä¿®å¾©å®Œäº†');
                showCurrentUsers();
            } else {
                log('â„¹ï¸ ä¿®æ­£ãŒå¿…è¦ãªæ¨©é™ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
            }
        }
        
        function addMissingUser() {
            const users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
            const tamuraEmail = 'tamura-wataru@terracom.co.jp';
            
            const exists = users.find(u => u.email === tamuraEmail);
            if (exists) {
                log('â„¹ï¸ tamura-wataru ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™');
                return;
            }
            
            const newUser = {
                id: Math.max(...users.map(u => u.id || 0)) + 1,
                name: 'ç”°æ‘æ¸‰',
                email: 'tamura-wataru@terracom.co.jp',
                password: 'aikakumei',
                role: 'user',
                department: '-',
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('systemUsers', JSON.stringify(users));
            
            log(`âœ… ${newUser.name}ã‚’systemUsersã«è¿½åŠ ã—ã¾ã—ãŸ`);
            showCurrentUsers();
        }
        
        // åˆæœŸè¡¨ç¤º
        showCurrentUsers();
    </script>
</body>
</html>