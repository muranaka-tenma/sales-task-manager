# 営業タスク管理システム - TODO一覧

**バージョン**: v005
**作成日**: 2025-12-01
**最終更新**: 2025-12-01
**合計残作業時間**: 約20-26.5時間

---

## ✅ 本日完了（2025-12-01）

### UI/UX 大規模改善プロジェクト - Phase 1 完了

#### 1. ✅ 絵文字完全削除・タイポグラフィ改善 **(完了)**
- すべてのモーダルタイトルから絵文字削除
- ステータス表示を絵文字 → テキストラベルに変更（`[公開]`, `[非公開]`, `[進行中]`, `[完了]`, `[保管中]`）
- タイトルのフォントウェイト強化（`font-weight: 600-700`）
- 色分けによる視覚的な区別を強化

#### 2. ✅ すべての要素の中央揃え統一 **(完了)**
- プロジェクト一覧（ヘッダー、カード名、メタ情報）
- カラムヘッダー（タイトル、件数）
- 表示対象ドロップダウン
- タスクカード（タイトル、期限、メモ、バッジ）

#### 3. ✅ 設定モーダルの最適化 **(完了)**
- モーダル横幅を 1600px → 600px に変更
- 期限アラート設定と表示設定を横並び（grid layout）

#### 4. ✅ ボタンサイズの完全統一 **(完了)**
- ユーザー管理・ダッシュボードボタンを他のボタンと同じサイズに統一
- 具体的なセレクタ + `!important` で強制適用

#### 5. ✅ CSS詳細度の問題解決 **(完了)**
- inline style が CSS class を上書きする問題を発見
- タスクカードの幅を inline style に直接追加
- **エラーログ作成**: `error-logs/2025-12-01-css-not-applying-inline-style-override.md`

#### 6. ✅ プロジェクト作成エラー修正 **(完了)**
- `TypeError: Cannot set properties of null` エラー解消
- 削除された DOM 要素へのアクセスを削除

#### 7. ✅ カラムカウンター視認性向上 **(完了)**
- 背景色を `rgba(0,0,0,0.1)` → `#026aa7` (青) に変更
- テキスト色を `#5e6c84` → `white` に変更
- `font-weight: 600` 追加

#### 8. ✅ UI視覚強化 **(完了)**
- カラムヘッダーにグラデーション背景追加
- タスクカードにソフトシャドウ（デュアルシャドウ）
- ホバーアニメーション強化（`translateY(-4px) scale(1.01)`）

#### 9. ✅ 既存機能の徹底調査 **(完了)**
- プログレスバー（期間レポートに実装済み）
- アニメーション（pulse, fadeIn, slideIn/Out 実装済み）
- ダッシュボード統計（`updateStats()`, `updateAnalyticsSummary()` 実装済み）
- テーマ切り替え（CSSルールのみ存在、機能未実装）

**関連ドキュメント**:
- `handover/requirements/2025-12-01-ui-enhancement-phase1.md`
- `error-logs/2025-12-01-requirement-misunderstanding-text-alignment.md`
- `error-logs/2025-12-01-css-not-applying-inline-style-override.md`

**作業時間**: 約4時間（実装2時間、デバッグ1時間、調査1時間）

---

## 🔴🔴🔴 最優先（緊急バグ）- 継続中

### ✅ 2025-12-01までに完了済み

#### 1. ✅ コメントメンションの通知機能が正常動作しない **(完了)**
- メンションした全員がSlack内でメンションされていない問題を修正
- **修正完了**: 2025-12-01
- **関連ログ**: error-logs/2025-11-21-mention-notification-fix.md

#### 2. ✅ 全データ削除ボタンが機能しなくなっている **(完了)**
- 設定画面の全データ削除ボタンが動作しない問題を修正
- **修正完了**: 2025-12-01
- **関連ログ**: error-logs/2025-11-28-clear-all-data-fix.md

#### 3. ✅ カラムの追加が即時反映されない **(完了)**
- プロジェクトカラム追加後、画面に即座に反映されない問題を修正
- **修正完了**: 2025-12-01
- **関連ログ**: error-logs/2025-11-28-project-edit-member-removal.md

---

## 🔴 高優先度（パフォーマンス・UI改善）

### 4. タスク作成と移動が重い - リファクタリング必要 **(3-5時間)** ⚠️大きな山
- タスク作成時のレスポンスが遅い
- ドラッグ&ドロップ時に `[Violation] 'drop' handler took 2574ms`
- 対応: Firebase保存の非同期化、楽観的UI更新、デバウンス適用

### 5. 新規タスクと複数選択ボタンの配置を中央寄りに **(30分)**
- ボタンの配置が使いづらい
- CSSレイアウト調整

### 6. 複数選択の削除機能の動作確認 **(1時間)**
- 複数選択での削除は完全に消えている？
- 削除とゴミ箱が機能混同していないか？
- 仕様の明確化と修正が必要

### 7. 右上のはてなボタンの機能更新 **(2時間)**
- 現在の機能に対応していないインフォメーション
- 将来的にマニュアル（使い方）を載せたい
- ヘルプシステムの設計が必要

---

## 🟡 中優先度（UI/UX Phase 2 - 実装候補）

### 8. カラムヘッダーにミニプログレスバー追加 **(1-2時間)**
- 各カラムの完了率を視覚化
- 既存の期間レポートのプログレスバーパターンを活用
- 実装例:
  ```javascript
  <div style="background: rgba(255,255,255,0.3); height: 3px; border-radius: 2px;">
      <div style="background: white; height: 100%; width: XX%; transition: width 0.3s;"></div>
  </div>
  ```

### 9. 統計サマリーのカード化 **(2時間)**
- グラデーションカード + プログレスバー
- 完了率、期限遵守率を視覚的に表示
- 実装例:
  ```html
  <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem; border-radius: 8px;">
      <div style="font-size: 2rem; font-weight: bold;">75%</div>
      <div>完了率</div>
      <div style="background: rgba(255,255,255,0.3); height: 4px; border-radius: 2px;">
          <div style="background: white; height: 100%; width: 75%;"></div>
      </div>
  </div>
  ```

### 10. タスク作成時のアニメーション **(1時間)**
- fadeIn + slideDown アニメーション
- 実装例:
  ```css
  @keyframes taskAppear {
      from { opacity: 0; transform: translateY(-10px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
  }
  .task-card.new-task {
      animation: taskAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  ```

### 11. カラーテーマ切り替え（LocalStorage使用） **(2-3時間)** 🎨 最後の仕上げ
- デバイスごとの設定保存（LocalStorage）
- `.dark-theme` クラスの切り替え機能実装（既存の10箇所のCSSルールを活用）
- 設定画面にテーマ選択ボタン追加
- **ユーザーコメント**: "当初やりたかったけどあきらめたんだよね。理由はわからないけど"
- **実装方針**:
  1. LocalStorage に `userTheme` を保存
  2. ページ読み込み時に `document.body.classList.add('dark-theme')` を適用
  3. 既存の `.dark-theme` CSSルール（10箇所）を活用
  4. 設定モーダルにテーマ切り替えボタン追加

---

## 🟡 中優先度（既存要件）

### 12. LocalStorage完全脱却プロジェクト **(3-5時間)** ⚠️超大きな山

現在132箇所でLocalStorage使用中

| データ | Firebase | LocalStorage | 状態 |
|-------|----------|--------------|------|
| タスク | ✅ | ❌ | 完全移行済み |
| プロジェクト | ✅ | ❌ | 完全移行済み |
| ユーザー情報 | ✅ | ⚠️ キャッシュ | 移行済み |
| currentSession | ❌ | ✅ | **要移行** |
| taskTemplates | ❌ | ✅ | **要移行** |
| projectSettings | ❌ | ✅ | **要移行** |
| kanbanColumns | ❌ | ✅ | **要移行** |
| recurringTemplates | ❌ | ✅ | **要移行** |

### 13. ユーザー追加時のセッション上書き問題 **(1時間)**
- 症状: ユーザー追加後、自動でそのユーザーにログインされてしまう
- ヘッダーは元のユーザー（邨中天真）のまま、マイページは追加したユーザーになる
- この状態で非表示タスクをチェックすると誰も選択されない
- 対応: createUser処理でセッションを上書きしないよう修正
- 関連ファイル: `user-management.html`の745行目付近

### 14. systemUsersのname未定義問題 **(30分)**
- 一部ユーザーのnameがundefined

### 15. プロジェクト公開設定の実装 **(30分)**
- 機能の動作確認
- 実装方法の調査

### 16. 管理者ダッシュボードのアクセス権限拡大 **(20分)**
- 加藤・朝日（admin権限）にもダッシュボード表示

### 17. メイン画面の統計ロジック確認 **(30分)**
- 「要調整」の判定ロジック調査

### 18. マイページの個人詳細統計 **(1時間)**
- 機能していない
- 所要時間集計の実現可能性調査

### 19. ダッシュボード統計ロジック確認 **(30分)**
- 完了タスク判別方法
- カラム名変更時の挙動

### 20. ユーザー管理の非表示/無効化の違い説明 **(20分)**

---

## 🟢 低優先度（調査・意見提示）

### 21. パスワードハードコード問題の解決 **(検討中)**
- login.htmlからパスワードを削除するか判断

### 22. シークレットタスク実現可能性 **(30分)**
- 非表示タスク機能は実装済み

### 23. 期限日・優先度の必要性 **(20分)**

### 24. テンプレートカテゴリ必要性確認 **(15分)**

---

## ⚪ 完了済み

### 2025-12-01 完了
- ✅ **UI/UX Phase 1 完了**（絵文字削除、中央揃え、設定モーダル、ボタンサイズ、CSS詳細度問題、カラムカウンター、UI強化）
- ✅ **コメントメンション通知修正**
- ✅ **全データ削除ボタン修正**
- ✅ **カラム追加即時反映修正**

### 2025-11-20 完了
- ✅ プロジェクトタスクのDONE/TRASH機能完全実装
- ✅ 完了・ゴミ箱への移動時アラート修正
- ✅ プロジェクト編集モーダルの×ボタン修正
- ✅ 完了カラムのタスクが期限切れで赤くなる問題を修正
- ✅ ゴミ箱の180日後自動削除機能をプロジェクトタスクにも対応
- ✅ プロジェクトタスク編集画面で管理IDを非表示
- ✅ 本番環境へデプロイ
- ✅ 包括的要件定義作成

### それ以前
- ✅ saveTasks データ消失バグ修正
- ✅ 非表示タスク機能実装
- ✅ モーダルスクロール位置リセット修正
- ✅ systemUsers初期化問題の根本解決
- ✅ Firebase認証時の日本語名取得修正
- ✅ E2Eテスト実装（Playwright）
- ✅ マイページ管理機能リンク削除
- ✅ パスワード変更機能確認
- ✅ 全データ削除機能の扱い提案（後回し決定）
- ✅ 本番環境ログイン問題の解決
- ✅ プロジェクトタスク作成モーダル統合
- ✅ 非表示タスクの自動チェック問題修正

---

## 📝 運用ルール

1. セッション終了時にこのファイルを更新
2. 大きな変更があった場合は新バージョン作成（例: `TODO-v006-2025-12-02.md`）
3. 「TODOを見せて」と言われたら、最も高いバージョン番号のファイルを読む
4. **要件定義は `handover/requirements/` に保存する**

### ⚠️ デプロイフロー（重要）

**必ず以下の順序を守ること：**

1. **開発環境でテスト** - `npm run test:local` でローカルテスト実行
2. **ユーザーのGOを待つ** - 本番デプロイ前に必ず承認を得る
3. **本番環境にデプロイ** - `git push` でNetlifyに自動デプロイ

**禁止事項：**
- ユーザー確認なしに本番環境を変更しない
- 開発環境でテストせずに本番デプロイしない

---

## 📁 関連ファイル

- **本番URL**: https://stellar-biscochitos-e19cb4.netlify.app/sales-task-core/
- **メインコード**: `sales-task-core/index-kanban.html`
- **プロジェクト設定**: `sales-task-core/pj-settings.html`
- **Firebase設定**: `sales-task-core/firebase-config-auth-fix-20250819-132508.js`
- **セッション履歴**: `SESSION.md`
- **最新要件定義**: `handover/requirements/2025-12-01-ui-enhancement-phase1.md`
- **前バージョンの要件**: `handover/requirements/2025-11-20-comprehensive-requirements.md`

---

## 🔧 本日の技術的な変更詳細（2025-12-01）

### 追加した機能
1. すべての要素の中央揃え統一
2. カラムヘッダーのグラデーション背景
3. タスクカードのソフトシャドウ
4. ホバーアニメーション強化

### 修正した関数
1. タスクカード生成関数 - inline styleに `width: 100%` 追加（行6858）
2. カラムヘッダー生成 - グラデーション追加（行6788）
3. プロジェクト作成関数 - null参照エラー修正（行13501削除）

### 重要な発見
- **CSS詳細度**: inline style > ID > class > element
- **動的生成要素**: inline styleに直接追加する必要がある
- **既存のプログレスバー**: 期間レポートモーダルに実装済み（行10763-10765）
- **既存のアニメーション**: pulse, fadeIn, slideIn/Out が実装済み

### CSS変更箇所
- Line 375-385: ボタンサイズ統一（具体的セレクタ + `!important`）
- Line 553-567: カラムヘッダー中央揃え
- Line 575-582: カラムカウンター視認性向上
- Line 592-616: タスクカードのシャドウ・アニメーション
- Line 655-724: タスクカード要素の中央揃え
- Line 1192-1205: 設定モーダル横幅変更
- Line 1768-1803: 設定モーダルグリッドレイアウト

---

## 🎯 次回セッション優先事項

### Phase 1: パフォーマンス改善（6.5-8.5時間）
1. タスク作成・移動のリファクタリング（3-5時間）
2. UI配置調整（30分）
3. 複数選択削除機能確認（1時間）
4. はてなボタン更新（2時間）

### Phase 2: UI/UX Phase 2 実装（6-8時間）
1. カラムヘッダーにミニプログレスバー（1-2時間）
2. 統計サマリーのカード化（2時間）
3. タスク作成時のアニメーション（1時間）
4. カラーテーマ切り替え（2-3時間） ← 最後の仕上げ

### Phase 3: LocalStorage脱却プロジェクト（3-5時間）
- currentSession, taskTemplates, projectSettings, kanbanColumns, recurringTemplates の移行

---

## 📊 作業時間見積もり（総計）

- 🔴 高優先度: 6.5-8.5時間
- 🟡 中優先度（UI/UX Phase 2）: 6-8時間
- 🟡 中優先度（既存要件）: 7.5-9.5時間
- 🟢 低優先度: 1.5時間

**総合計**: 約20-26.5時間

---

## 🚨 重要な教訓（2025-12-01）

### コミュニケーション
1. **ユーザーが2回以上繰り返したら、自分の理解が間違っている**
2. **スクリーンショットを最優先で確認**
3. **推測ではなく、必ず確認**

### 技術
1. **CSS詳細度**: inline style (1-0-0-0) > class (0-0-1-0)
2. **動的生成要素**: inline styleに直接追加する必要がある
3. **開発者ツール（F12）**: CSS変更が反映されない場合、必ず要素を検証

### エラーログ
- すべてのバグ修正時には必ずエラーログを作成
- 同じミスを繰り返さないための参照資料
- 作成ルールは `DEVELOPMENT_GUIDELINES.md` を参照

---

**最終更新**: 2025-12-01
**作成者**: Claude Code
**レビュー**: 邨中天真
